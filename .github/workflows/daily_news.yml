name: Global Market Intelligence Bot

on:
  schedule:
    # 早报 (北京时间 8:00) - 关注美股收盘、昨夜欧美大事
    - cron: '0 0 * * *'  # UTC时间0点，即北京时间早上8点
    # 午报 (北京时间 13:00) - 关注 A 股/港股午间休市动态、亚太地缘突发
    - cron: '0 5 * * *'  # UTC时间5点，即北京时间下午13点
    # 晚报 (北京时间 21:00) - 关注欧股开盘、美股盘前动态
    - cron: '0 13 * * *'  # UTC时间13点，即北京时间晚上21点
    # 日终汇总 (北京时间 00:00) - 全天总结和明日前瞻
    - cron: '0 16 * * *'  # UTC时间16点，即北京时间晚上24点(次日0点)
    # 紧急监控 (每30分钟一次) - 检测重大事件，只有当Abs(情绪分) >= 9时才推送
    - cron: '*/30 * * * *'  # 每30分钟运行一次
  workflow_dispatch: # 允许手动触发

jobs:
  run-news-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run urgent news monitor (for scheduled triggers every 30 minutes)
      if: github.event_name == 'schedule' && contains(github.event.schedule, '*/30')
      env:
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        FEISHU_WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}
      run: |
        python urgent_news_monitor.py

    - name: Run regular news bot (for other scheduled times)
      if: github.event_name == 'schedule' && !contains(github.event.schedule, '*/30')
      env:
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        FEISHU_WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}
      run: |
        python daily_news_bot.py
